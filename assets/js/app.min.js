_.extend(Marionette.Application.prototype,{debugLog:function(a,b){_.isUndefined(this.debug)&&(this.debug=localStorage.getItem("wc_pos_debug")?!0:!1,Backbone.Radio.DEBUG=this.debug,console.info("Debugging is "+(this.debug?"on":"off")+", visit http://woopos.com.au/docs/debugging")),this.debug&&console[a](b)},navigate:function(a,b){b||(b={}),Backbone.history.navigate(a,b)},getCurrentRoute:function(){var a=Backbone.history.fragment;return _.isEmpty(a)?null:a},startHistory:function(){return Backbone.history?Backbone.history.start():void 0},register:function(a,b){return this._registry||(this._registry={}),this._registry[b]=a},unregister:function(a,b){return delete this._registry[b]},resetRegistry:function(){var a,b,c,d,e;d=this.getRegistrySize(),e=this._registry;for(b in e)a=e[b],a.region.close();return c="There were "+d+" controllers in the registry, there are now "+this.getRegistrySize(),this.getRegistrySize()>0?console.warn(c,this._registry):console.log(c)},getRegistrySize:function(){return _.size(this._registry)},round:function(a,b){return void 0===b&&(b=accounting.settings.number.precision),parseFloat(accounting.toFixed(a,b))},unformat:function(a){return accounting.unformat(a,accounting.settings.number.decimal)},formatNumber:function(a,b){return void 0===b&&(b=accounting.settings.number.precision),"auto"===b&&(b=(+a).toFixed(4).replace(/^-?\d*\.?|0+$/g,"").length),accounting.formatNumber(a,b)},isPositiveInteger:function(a,b){var c=~~Number(a);return b?String(c)===a&&c>=0:String(c)===a&&c>0}});var POS=new Marionette.Application;POS.addRegions({headerRegion:"#header",menuRegion:"#menu",mainRegion:"#main",modalRegion:"#modal"}),Marionette.Behaviors.getBehaviorClass=function(a,b){return POS.Components[b].Behavior},POS.channel.reply("default:region",function(){return POS.mainRegion}),POS.channel.comply("register:instance",function(a,b){return POS.register(a,b)}),POS.channel.comply("unregister:instance",function(a,b){return POS.unregister(a,b)}),POS.module("Entities",function(a){a.channel=Backbone.Radio.channel("entities")}),POS.addInitializer(function(a){var b=["ajaxurl","nonce","wc_api","tax","worker"];_(b).each(function(b){_.isUndefined(a[b])||(POS[b]=a[b])}),accounting.settings=a.accounting}),POS.on("start",function(){POS.debugLog("log","POS App started"),POS.startHistory(),POS.HeaderApp.start()}),Backbone.$.wc_pos_ajax=function(a){return _.merge(a,{url:POS.ajaxurl,data:{security:POS.nonce},beforeSend:function(a){a.setRequestHeader("X-WC-POS",1)}}),Backbone.$.ajax(a)},POS.Controller={},POS.Controller.Base=Marionette.Controller.extend({constructor:function(a){return a||(a={}),this.region=a.region||POS.channel.request("default:region"),this._instance_id=_.uniqueId("controller"),POS.channel.command("register:instance",this,this._instance_id),Marionette.Controller.prototype.constructor.apply(this,arguments)},destroy:function(){return POS.channel.command("unregister:instance",this,this._instance_id),Marionette.Controller.prototype.destroy.apply(this,arguments)},show:function(a,b){b||(b={}),_.defaults(b,{loading:!1,region:this.region}),this._setMainView(a),this._manageView(a,b)},_setMainView:function(a){this._mainView||(this._mainView=a,this.listenTo(a,"destroy",this.destroy))},_manageView:function(a,b){return b.loading?POS.Components.Loading.channel.command("show:loading",a,b):void b.region.show(a)}}),POS.module("Entities",function(a){a.DB={id:"woocommerce-pos",description:"Local cache for WooCommerce POS",debug:!1,migrations:[{version:"1",migrate:function(a){a.objectStoreNames.contains("products")||a.createObjectStore("products",{keyPath:"id"})}},{version:"2",migrate:function(a){a.objectStoreNames.contains("orders")||a.createObjectStore("orders",{keyPath:"id"})}}]}}),POS.module("Entities",function(a,b,c){a.Product=c.DualModel.extend({urlRoot:function(){return b.wc_api+"products"},parse:function(a){return a.product?a.product:a}}),a.Products=c.DualCollection.extend({model:a.Product,url:function(){return b.wc_api+"products"},initialize:function(){this.indexedDB=new c.IndexedDB({storeName:"products",storePrefix:"wc_pos_",dbVersion:1,keyPath:"id"},this)},state:{pageSize:10},parseState:function(a,b,c,d){var e=parseInt(d.xhr.getResponseHeader("X-WC-Total")),f=parseInt(d.xhr.getResponseHeader("X-WC-TotalPages"));return{totalRecords:e,totalPages:f}},parse:function(a){return a.products?a.products:a}}),a.channel.reply("product",function(b){return new a.Product(b)}),a.channel.reply("products",function(){return new a.Products})}),POS.module("Entities",function(a){a.channel.reply("order",function(b){return new a.Orders.Model(b)}),a.channel.reply("orders",function(){return new a.Orders.Collection})}),POS.module("Entities.Orders",function(a,b,c){a.Model=c.DualModel.extend({idAttribute:"local_id",remoteIdAttribute:"id"})}),POS.module("Entities.Orders",function(a,b,c,d,e,f){a.Collection=c.DualCollection.extend({model:a.Model,url:function(){return b.wc_api+"orders"},initialize:function(){this.indexedDB=new c.IndexedDB({storeName:"orders",storePrefix:"wc_pos_",dbVersion:1,keyPath:"local_id",autoIncrement:!0,indexes:[{name:"local_id",keyPath:"local_id",unique:!0},{name:"id",keyPath:"id",unique:!0},{name:"status",keyPath:"status",unique:!1}]},this)},parse:function(a){return a.orders?a.orders:a},fetchLocal:function(){var a=this,b=e.Deferred(),c=function(b){f(b).has("id")||a.add(b)},d=function(){b.resolve()};return a.indexedDB.iterate(c,{index:"local_id",order:"ASC",onEnd:d}),b}})}),POS.module("Entities",function(a,b,c){a.Customer=c.DualModel.extend({urlRoot:function(){return b.wc_api+"customers"},parse:function(a){return a.customer?a.customer:a}}),a.Customers=c.DualCollection.extend({model:a.Customer,url:function(){return b.wc_api+"customers"},initialize:function(){this.indexedDB=new c.IndexedDB({storeName:"wc_pos_customers",dbVersion:1,keyPath:"id",indexes:[]},this)},state:{pageSize:10},parseState:function(a,b,c,d){var e=parseInt(d.xhr.getResponseHeader("X-WC-Total")),f=parseInt(d.xhr.getResponseHeader("X-WC-TotalPages"));return{totalRecords:e,totalPages:f}},parseRecords:function(a){return a.customers?a.customers:a}}),a.channel.reply("customer",function(b){return new a.Customer(b)}),a.channel.reply("customers",function(){return new a.Customers})}),POS.module("Entities",function(a,b,c){a.Coupon=c.DualModel.extend({urlRoot:function(){return b.wc_api+"coupons"},parse:function(a){return a.coupon?a.coupon:a}}),a.Coupons=c.DualCollection.extend({model:a.Order,url:function(){return b.wc_api+"coupons"},initialize:function(){this.indexedDB=new c.IndexedDB({storeName:"wc_pos_coupons",dbVersion:1,keyPath:"id",indexes:[]},this)},state:{pageSize:10},parseState:function(a,b,c,d){var e=parseInt(d.xhr.getResponseHeader("X-WC-Total")),f=parseInt(d.xhr.getResponseHeader("X-WC-TotalPages"));return{totalRecords:e,totalPages:f}},parseRecords:function(a){return a.coupons?a.coupons:a}}),a.channel.reply("coupon",function(b){return new a.Coupon(b)}),a.channel.reply("coupons",function(){return new a.Coupons})}),POS.module("Entities",function(a){a.channel.reply("cart",function(b){return new a.Cart.Collection([],b)})}),POS.module("Entities.Cart",function(a,b,c,d,e,f){a.Model=c.Model.extend({idAttribute:"local_id",remoteIdAttribute:"id",defaults:{subtotal:0,subtotal_tax:0,total_tax:0,total:0,item_price:0,item_tax:0,qty:1},initialize:function(){this.collection.order&&this.set({order:this.collection.order.id}),this.on("change:qty change:item_price",this.updateLineTotals),0===this.get("item_price")&&this.set({item_price:parseFloat(this.get("price"))})},updateLineTotals:function(){var a=this.get("qty"),c=this.get("item_price"),d=parseFloat(this.get("regular_price")),e=this.calcTax(d),f=this.calcTax(c,a);"yes"===b.tax.prices_include_tax&&(d-=e,c-=f),this.save({item_subtotal:d,item_subtotal_tax:e,subtotal:b.round(d*a,4),subtotal_tax:b.round(e*a,4),item_tax:b.round(f,4),total_tax:b.round(f*a,4),total:b.round(c*a,4)})},calcTax:function(a,c){var d=0;return this.get("taxable")&&"yes"===b.tax.calc_taxes&&(d="yes"===b.tax.prices_include_tax?this.calcInclusiveTax(a,c):this.calcExclusiveTax(a,c)),d},calcInclusiveTax:function(a,c){var d=this.get("tax_rates"),e=0,g=0,h=0,i=0,j=0;if(void 0===c){var k=!0;c=1}f(d).each(function(a){"yes"===a.compound?g+=parseFloat(a.rate):e+=parseFloat(a.rate)});var l=1+e/100,m=1+g/100;return h=a/m,f(d).each(function(d,e){var f=parseFloat(d.rate)/100,g=0;"yes"===d.compound?(g=a,f/=m):(g=h,f/=l);var n=a-f*g;i=a-n;var o=b.round(i,4),p=b.round(i*c,4);this.set("item_tax_"+e,o),this.set("line_tax_"+e,p),d.tax_amount=p,j+=o,k&&(d.subtotal_tax=o)},this),b.round(j,4)},calcExclusiveTax:function(a,c){var d=this.get("tax_rates"),e=[],g=0,h=0,i=0;if(void 0===c){var j=!0;c=1}return f(d).each(function(b,c){h=0,"yes"!==b.compound&&(h=a*(parseFloat(b.rate)/100)),e[c]=h}),e.length>0&&(g=e.reduce(function(a,b){return a+b})),f(d).each(function(d,f){if("yes"===d.compound){var h=a+g;e[f]=h*(parseFloat(d.rate)/100)}var k=b.round(e[f],4),l=b.round(e[f]*c,4);this.set("item_tax_"+f,k),this.set("line_tax_"+f,l),d.tax_amount=l,i+=k,j&&(d.subtotal_tax=k)},this),b.round(i,4)},quantity:function(a){var b=this.get("qty");this.set("qty","increase"===a?++b:--b)}})}),POS.module("Entities.Cart",function(a,b,c,d,e,f){a.Collection=c.Collection.extend({model:a.Model,local:!0,initialize:function(a,b){this.indexedDB=new c.IndexedDB({storeName:"cart",storePrefix:"wc_pos_",dbVersion:1,keyPath:"local_id",autoIncrement:!0,indexes:[{name:"local_id",keyPath:"local_id",unique:!0},{name:"id",keyPath:"id",unique:!1},{name:"order",keyPath:"order",unique:!1},{name:"status",keyPath:"status",unique:!1}]},this),b.order&&(this.order=b.order),this.on("add remove change",this.calcTotals)},calcTotals:function(){var a,c,d,e=0;a=f(this.pluck("subtotal")).reduce(function(a,b){return a+b},0),c=f(this.pluck("subtotal_tax")).reduce(function(a,b){return a+b},0),d=f(this.pluck("total")).reduce(function(a,b){return a+b},0),"yes"===b.tax.calc_taxes&&(e=f(this.pluck("total_tax")).reduce(function(a,b){return a+b},0));var g={subtotal:b.round(a,4),subtotal_tax:b.round(c,4),cart_discount:b.round(a-d,4),total_tax:b.round(e,4)};this.order.save(g)},fetchOrder:function(a){var b=this,c=e.Deferred(),d=function(c){c.order===a&&b.add(c)},f=function(){c.resolve()};return b.indexedDB.iterate(d,{index:"order",order:"ASC",onEnd:f}),c}})}),POS.module("Entities.Settings",function(a,b,c,d,e,f){b.addInitializer(function(b){a.hotkeys=new a.Usermeta(b.hotkeys,{id:"hotkeys"}),a.tabs=new a.Usermeta(b.tabs,{id:"tabs"})}),a.Usermeta=c.Collection.extend({initialize:function(a,b){this.id=b.id},save:function(){var a=this.toJSON(),c={id:this.id,action:"wc_pos_user_settings",security:b.nonce,data:a[0]};e.post(b.ajaxurl,c,function(a){console.log(a)})}}),a.Option=c.Model.extend({initialize:function(){this.url=b.ajaxurl,this._saving=!1},sync:function(a,d,e){var g="id="+d.get("id"),h="action=wc_pos_admin_settings",i="security="+b.nonce;e.emulateHTTP=!0,e.url=d.url+"?"+h+"&"+g+"&"+i;var j={beforeSend:function(){this.trigger("update:start"),this._saving=!0},complete:function(){this.trigger("update:stop"),this._saving=!1}};return this._saving||"update"!==a||f.defaults(e,{beforeSend:f.bind(j.beforeSend,d),complete:f.bind(j.complete,d)}),c.sync(a,d,e)}}),a.Options=c.Collection.extend({model:a.Option}),b.Entities.channel.reply("hotkeys",function(){return a.hotkeys}),b.Entities.channel.reply("tabs",function(){return a.tabs}),b.Entities.channel.reply("options",function(b){return new a.Options([],b)})}),POS.module("Components.HotKeys",function(a,b,c,d,e,f){a.Behavior=d.Behavior.extend({initialize:function(){this.view.on("render",this.onRender,this)},onRender:function(){var a=b.Entities.channel.request("hotkeys");f.each(this.view.keyEvents,function(c,d){var f=a.get(d);f?e(document).bind("keydown",f.get("key"),this.view[c]):b.debugLog("warn","Hotkey not found, id: "+d)},this)},onClose:function(){f.each(this.view.keyEvents,function(a){e(document).unbind("keydown",this.view[a])},this)}})}),POS.module("Components.Loading",function(a,b,c,d,e,f){a.channel=c.Radio.channel("loading"),a.channel.comply("show:loading",function(b,c){return new a.Controller({view:b,region:c.region,config:c.loading})}),a.Controller=b.Controller.Base.extend({initialize:function(b){var c=b.view,d=b.config;switch(d=f.isBoolean(d)?{}:d,f.defaults(d,{loadingType:"spinner"}),d.loadingType){case"spinner":var e=new a.Spinner;this.show(e);break;case"opacity":this.region.currentView.$el.css({opacity:.5});break;default:throw new Error("Invalid loadingType")}this.showRealView(c,e,d)},showRealView:function(a,b,c){var d=this,g=c.entities;f.isArray(g)||(g=[c.entities]),e.when.apply(e,g).always(function(){switch(c.loadingType){case"spinner":if(d.region.currentView!==b)return a.close();break;case"opacity":d.region.currentView.$el.removeAttr("style")}d.show(a)})}})}),POS.module("Components.Loading",function(a,b,c,d){a.Spinner=d.ItemView.extend({template:!1,className:"loading"})}),POS.module("Components.Modal",function(a,b,c,d,e,f){b.addInitializer(function(){new a.Controller({container:b.modalRegion})}),a.channel=c.Radio.channel("modal"),a.Controller=d.Controller.extend({initialize:function(b){this.container=b.container,this.view=new a.View,this.container.show(this.view),f.bindAll(this,"openModal","closeModal"),a.channel.comply("open",this.openModal),a.channel.comply("close",this.closeModal)},openModal:function(a){this.view.openModal(a)},closeModal:function(a){this.view.closeModal(a)}})}),POS.module("Components.Modal",function(a,b,c,d,e,f){a.View=d.LayoutView.extend({template:f.template('<div class="modal-dialog"><div class="modal-content"></div></div>'),className:"modal",attributes:{tabindex:-1,role:"dialog"},regions:{content:".modal-content"},initialize:function(){this.$el.modal({show:!1})},triggers:{"show.bs.modal":{preventDefault:!1,event:"show:modal"},"shown.bs.modal":{preventDefault:!1,event:"after:show:modal"},"hide.bs.modal":{preventDefault:!1,event:"hide:modal"},"hidden.bs.modal":{preventDefault:!1,event:"after:hide:modal"}},openModal:function(a){this.once("after:show:modal",a.callback),this.setupModal(a),this.$el.modal("show")},closeModal:function(a){this.once("after:hide:modal",a.callback),this.once("after:hide:modal",this.teardownModal),this.$el.modal("hide")},setupModal:function(a){this.isShown&&this.teardownModal(),this.content.show(a.view),this.isShown=!0},teardownModal:function(){this.isShown&&(this.content.empty(),this.isShown=!1)}})}),POS.module("Components.Modal",function(a,b,c,d){a.Behavior=d.Behavior.extend({initialize:function(){this.listenToOnce(this.view,"modal:open",this.openModal)},openModal:function(b){a.channel.command("open",{view:this.view,callback:b}),this.listenToOnce(this.view,"modal:close",this.closeModal)},closeModal:function(b){a.channel.command("close",{callback:b})}})}),POS.module("Components.Tooltip",function(a,b,c,d,e,f){a.Behavior=d.Behavior.extend({initialize:function(a){this.options=f.defaults(a,{})},ui:{tooltip:'*[data-toggle="tooltip"]'},onRender:function(){this.ui.tooltip.tooltip(this.options)},onBeforeDestroy:function(){this.ui.tooltip.tooltip("destroy")}})}),POS.module("Components.Filter",function(a,b,c,d,e,f){a.Behavior=d.Behavior.extend({ui:{searchField:"input[type=search]",clearBtn:"a.clear"},events:{"keyup @ui.searchField":"searchTrigger","click @ui.clearBtn":"clear"},onRender:function(){},searchTrigger:function(){this.showClearButtonMaybe()},clear:function(a){a.preventDefault(),this.ui.searchField.val(""),this.showClearButtonMaybe()},showClearButtonMaybe:function(){f.isEmpty(this.ui.searchField.val())?this.ui.clearBtn.hide():this.ui.clearBtn.show()}})}),POS.module("Components.Pulse",function(a,b,c,d,e){a.Behavior=d.Behavior.extend({modelEvents:{"pulse:item":"pulseItem"},pulseItem:function(){this.$("td").addClass("bg-success").animate({backgroundColor:"transparent"},500,function(){e(this).removeClass("bg-success").removeAttr("style")})}})}),POS.module("Components.AutoGrow",function(a,b,c,d,e,f){a.Behavior=d.Behavior.extend({initialize:function(a){this.options=a||(a={}),f.defaults(this.options,{padding:20}),this.tester=e("#autogrow-tester"),0===this.tester.length&&(this.tester=e('<div id="autogrow-tester" />').css({opacity:0,top:-9999,left:-9999,position:"absolute",whiteSpace:"nowrap"}),e("body").append(this.tester))},ui:{input:".autogrow"},events:{"input @ui.input":"onInputEvent"},onRender:function(){f.each(this.ui.input,function(a){e(a).trigger("input")},this)},onInputEvent:function(a){var b=e(a.target),c=b.val();c=c.replace(/&/g,"&amp;").replace(/\s/g,"&nbsp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),this.tester.html(c);var d=this.tester.width()+this.options.padding;b.css({width:d})}})}),POS.module("Components.Tabs",function(a,b,c){a.channel=c.Radio.channel("tabs"),a.channel.reply("get:tabs",function(b){var c=new a.View({collection:b});return c})}),POS.module("Components.Tabs",function(a,b,c,d){a.ItemView=d.ItemView.extend({tagName:"li",initialize:function(){this.template=Handlebars.compile('{{#unless fixed}}<a href="#"><i class="icon icon-times-circle action-remove"></i></a>{{/unless}}{{ label }}')},className:function(){return this.model.get("active")?"active":void 0},triggers:{click:"tab:clicked","click .action-remove":"tab:removed"},onTabClicked:function(){this.model.get("active")||this.model.set({active:!0})}}),a.View=d.CollectionView.extend({tagName:"ul",childView:a.ItemView,attributes:{role:"tablist"},collectionEvents:{"change:active":"render"},initialize:function(){this.on("childview:tab:removed",function(a,b){this.collection.remove(b.model)})}})}),POS.module("Components.Tabs",function(a,b,c,d,e,f){a.Model=c.Model.extend({defaults:{label:"",value:"",active:!1,fixed:!0},idAttribute:"value"}),a.Collection=c.Collection.extend({model:a.Model,initialize:function(){this.on("remove",this.onRemove),this.on("change:active",this.onChangeActive)},onRemove:function(){var a=f.compact(this.pluck("active"));f.isEmpty(a)&&this.first().set({active:!0})},onChangeActive:function(a){this.each(function(b){a.id!==b.id&&b.set({active:!1},{silent:!0})})}})}),POS.module("HeaderApp",function(a,b,c,d,e,f,g){a.startWithParent=!1,a.on("start",function(){this.view=new a.View,this.menu=new a.Menu}),a.View=d.ItemView.extend({el:e("#header"),ui:{menu:"#menu-btn"},events:{"click @ui.menu":"toggleMenu"},keyEvents:{help:"showHelpModal"},behaviors:{HotKeys:{}},toggleMenu:function(a){a.preventDefault(),e("body").toggleClass("menu-open")},showHelpModal:function(){new a.HelpModal}}),a.HelpModal=d.ItemView.extend({behaviors:{Modal:{},Tooltip:{}},initialize:function(){this.template=g.compile(e("#tmpl-wc-pos-help-modal").html()),this.collection=b.Entities.channel.request("hotkeys"),this.trigger("modal:open")},serializeData:function(){return{hotkeys:this.collection.toJSON()}},events:{"click .save":"save","click .close":"cancel"},save:function(){var a=c.Syphon.serialize(this);this.collection.set(a),this.collection.save()},cancel:function(){this.trigger("modal:close")}}),a.Menu=d.ItemView.extend({el:e("#menu"),events:{"click ul li a":"menuItemClicked"},menuItemClicked:function(){e("body").toggleClass("menu-open")}})},Handlebars),POS.module("POSApp",function(a,b,c,d,e,f){a.startWithParent=!1,a.channel=c.Radio.channel("pos");var g={init:function(){f.isUndefined(a.layout)&&new a.Products.Controller},cart:function(b){this.init(),new a.Cart.Controller({id:b})},checkout:function(){this.init(),new a.Checkout.Controller},receipt:function(){this.init(),new a.Receipt.Controller}};b.addInitializer(function(){new d.AppRouter({controller:g,appRoutes:{"":"cart",cart:"cart","cart/:id":"cart",checkout:"checkout","checkout/:id":"checkout","receipt/:id":"receipt"}})}),a.channel.comply("show:cart",function(a){b.navigate(a?"cart/"+a:""),g.cart(a)}),a.channel.comply("show:checkout",function(a){b.navigate(a?"checkout/"+a:"checkout"),g.checkout(a)}),a.channel.comply("show:receipt",function(a){b.navigate(a?"receipt/"+a:"receipt"),g.receipt(a)})}),POS.module("POSApp.Products",function(a,b){a.Controller=b.Controller.Base.extend({initialize:function(){b.POSApp.layout=new b.POSApp.Layout,b.mainRegion.$el.addClass("two-column"),this.show(b.POSApp.layout,{region:b.mainRegion});var c=b.Entities.channel.request("products");this.layout=new a.Layout,this.listenTo(this.layout,"show",function(){this.showFilter(),this.showTabs(),this.showProducts(c)}),c.once("idb:ready",function(){b.Components.Loading.channel.command("show:loading",this.layout,{region:b.POSApp.layout.leftRegion,loading:{entities:c.fetch()}})},this)},showFilter:function(){var b=new a.Filter;this.layout.actionsRegion.show(b)},showTabs:function(){var a=b.Entities.channel.request("tabs"),c=b.Components.Tabs.channel.request("get:tabs",a);this.layout.tabsRegion.show(c)},showProducts:function(c){var d=new FilteredCollection(c),e=new a.List({collection:d});this.listenTo(e,"childview:cart:add:clicked",function(a,c){b.POSApp.channel.command("cart:add",c.model)}),this.listenTo(e,"childview:product:variations:clicked",function(a,b){var c={label:b.model.get("title"),value:"parent:"+b.model.get("id"),fixed:!1};this.trigger("add:new:tab",c)}),this.layout.listRegion.show(e)},onDestroy:function(){delete b.POSApp.layout,b.mainRegion.$el.removeClass("two-column")}})}),POS.module("POSApp.Products",function(a,b,c,d,e,f,g){b.POSApp.Layout=d.LayoutView.extend({template:f.template('<div id="left"></div><div id="right"></div>'),regions:{leftRegion:"#left",rightRegion:"#right"}}),a.Layout=d.LayoutView.extend({template:f.template('<div class="list-actions"></div><div class="list-tabs tabs infinite-tabs"></div><div class="list"></div><div class="list-footer"></div>'),tagName:"section",regions:{actionsRegion:".list-actions",tabsRegion:".list-tabs",listRegion:".list"},attributes:{"class":"module products-module"}}),a.Filter=d.ItemView.extend({initialize:function(){this.template=g.compile(e("#tmpl-products-filter").html())},behaviors:{Filter:{}}}),a.Item=d.ItemView.extend({tagName:"li",className:function(){return this.isVariable()?"variable":void 0},initialize:function(){this.template=g.compile(e("#tmpl-product").html())},triggers:{"click .action-add":"cart:add:clicked","click .action-variations":"product:variations:clicked"},onBeforeRender:function(){this.isVariable()&&this.model.set("isVariable",!0)},isVariable:function(){return"variable"===this.model.get("type")?!0:void 0}}),a.Empty=d.ItemView.extend({tagName:"li",template:"#tmpl-products-empty"}),a.List=d.CollectionView.extend({tagName:"ul",childView:a.Item,emptyView:a.Empty,initialize:function(){this.collection.bind("request",this.ajaxStart,this),this.collection.bind("sync",this.ajaxComplete,this)},ajaxStart:function(){this.$el.css({opacity:.5})},ajaxComplete:function(){this.$el.removeAttr("style")}}),a.Pagination=d.ItemView.extend({initialize:function(){this.template=g.compile(e("#tmpl-pagination").html())},triggers:{"click a.sync":"pagination:sync:clicked","click a.destroy":"pagination:clear:clicked"},events:{"click a.prev":"previous","click a.next":"next"},collectionEvents:{"sync reset":"render"},serializeData:function(){var a=f.clone(this.collection.state);if(Modernizr.indexeddb){var c=new Date(parseInt(b.Entities.channel.request("options:get","last_update")));a.last_update=c.getTime()>0?c.toLocaleTimeString():" - "}return a.currentRecords=a.currentPage===a.lastPage?a.totalRecords-a.pageSize*(a.currentPage-1):a.pageSize,a.totalPages=a.totalPages?a.totalPages:1,a.totalRecords=a.totalRecords?a.totalRecords:0,a},previous:function(a){a.preventDefault(),this.collection.hasPreviousPage()&&this.collection.getPreviousPage()},next:function(a){a.preventDefault(),this.collection.hasNextPage()&&this.collection.getNextPage()}})},Handlebars),POS.module("POSApp.Cart",function(a,b,c,d,e){a.Controller=b.Controller.Base.extend({initialize:function(c){this.layout=new a.Layout,this.listenTo(this.layout,"show",function(){this.showCart()}),this.show(this.layout,{region:b.POSApp.layout.rightRegion,loading:{entities:this.initCart(c)}})},initCart:function(a){var c,d=e.Deferred(),f=b.Entities.channel.request("orders");return f.once("idb:ready",function(){f.fetchLocal().done(function(){c=a.id?f.findWhere({local_id:a.id}):f.length>0?f.at(0):f.add(),this.getCartItems(c).done(function(a){this.orders=f,this.order=c,this.cart=a,d.resolve()}.bind(this))}.bind(this))},this),d},getCartItems:function(a){var c=e.Deferred(),d=b.Entities.channel.request("cart",{order:a});return d.once("idb:ready",function(){d.fetchOrder(a.id).done(function(){c.resolve(d)})}),c},showCart:function(){var c=new a.List({collection:this.cart});this.layout.listRegion.show(c),b.POSApp.channel.comply("cart:add",function(a){var b=this.cart.findWhere({id:a.attributes.id});b?b.quantity("increase"):b=this.cart.add(a.attributes),b.trigger("pulse:item")},this),this.showTotals(),this.showActions()},showTotals:function(){var b=new a.Totals({model:this.order});this.layout.totalsRegion.show(b)},showActions:function(){var b=new a.Actions({});this.layout.actionsRegion.show(b)}})}),POS.module("POSApp.Cart",function(a,b,c,d,e,f){a.Layout=d.LayoutView.extend({template:f.template(e("#tmpl-cart").html()),tagName:"section",regions:{listRegion:".list",totalsRegion:".list-totals",actionsRegion:".cart-actions"},attributes:{"class":"module cart-module"}}),a.Item=d.ItemView.extend({tagName:"li",initialize:function(){this.template=Handlebars.compile(e("#tmpl-cart-item").html())},behaviors:{AutoGrow:{},Pulse:{}},modelEvents:{change:"render"},events:{"click .action-remove":"removeItem","keypress input":"saveOnEnter","blur input":"onBlur"},remove:function(){this.$el.parent("ul").addClass("animating"),this.$("li").addClass("bg-danger"),this.$el.fadeOut(500,function(){this.$el.parent("ul").removeClass("animating"),d.ItemView.prototype.remove.call(this)}.bind(this))},removeItem:function(){this.model.destroy()}}),a.EmptyView=d.ItemView.extend({tagName:"li",template:"#tmpl-cart-empty"}),a.List=d.CollectionView.extend({tagName:"ul",childView:a.Item,emptyView:a.EmptyView,serializeData:function(a){console.log(a)}}),a.Totals=d.ItemView.extend({tagName:"ul",initialize:function(){this.template=Handlebars.compile(e("#tmpl-cart-totals").html())},modelEvents:{change:"render"}}),a.Actions=d.ItemView.extend({template:f.template(e("#tmpl-cart-actions").html()),triggers:{"click .action-void":"cart:void:clicked","click .action-note":"cart:note:clicked","click .action-discount":"cart:discount:clicked","click .action-checkout":"cart:checkout:clicked"}})}),POS.module("POSApp.Checkout",function(a,b){a.Controller=b.Controller.Base.extend({initialize:function(){var c=b.Entities.channel.request("orders");this.layout=new a.Layout,this.listenTo(this.layout,"show",function(){this.showCheckout()}),c.once("idb:ready",function(){this.show(this.layout,{region:b.POSApp.layout.rightRegion,loading:{entities:c.fetch({cart:!0})}})},this)},showCheckout:function(){}})}),POS.module("POSApp.Checkout",function(a,b,c,d,e,f){a.Layout=d.LayoutView.extend({template:f.template('<a href="#receipt/1">receipt</a>')})}),POS.module("POSApp.Receipt",function(a,b){a.Controller=b.Controller.Base.extend({initialize:function(){var c=b.Entities.channel.request("orders");this.layout=new a.Layout,this.listenTo(this.layout,"show",function(){this.showReceipt()}),c.once("idb:ready",function(){this.show(this.layout,{region:b.POSApp.layout.rightRegion,loading:{entities:c.fetch({cart:!0})}})},this)},showReceipt:function(){}})}),POS.module("POSApp.Receipt",function(a,b,c,d,e,f){a.Layout=d.LayoutView.extend({template:f.template('<a href="#cart">cart</a>')})}),POS.module("SupportApp",function(a,b,c,d){a.startWithParent=!1,a.channel=c.Radio.channel("support");var e={show:function(){new a.Show.Controller}};POS.addInitializer(function(){new d.AppRouter({controller:e,appRoutes:{support:"show"}})})}),POS.module("SupportApp.Show",function(a,b,c,d,e){a.Controller=b.Controller.Base.extend({initialize:function(){this.layout=new a.Layout,this.listenTo(this.layout,"show",function(){this._showForm(),this._showStatus()}),this.show(this.layout,{region:b.mainRegion})},_showForm:function(){var b=new a.Form;this.listenTo(b,"send:email",function(a){e.wc_pos_ajax({type:"POST",data:{action:"wc_pos_send_support_email",payload:a}})}),this.layout.leftRegion.show(b)},_showStatus:function(){var c=e.wc_pos_ajax({type:"GET",data:{action:"wc_pos_system_status"}}),d=new a.Status(c);b.Components.Loading.channel.command("show:loading",d,{region:this.layout.rightRegion,loading:{entities:c}})}})}),POS.module("SupportApp.Show",function(a,b,c,d,e,f,g){a.Layout=d.LayoutView.extend({template:f.template('<section id="support-form" class="module leftcol"></section><section id="system-status" class="module rightcol"></section>'),regions:{leftRegion:"#support-form",rightRegion:"#system-status"}}),a.Form=d.ItemView.extend({template:"#tmpl-support-form",tagName:"form",events:{submit:"send"},send:function(a){a.preventDefault();var b=c.Syphon.serialize(this);this.trigger("send:email",b)}}),a.Status=d.ItemView.extend({initialize:function(a){this.template=g.compile(e("#tmpl-pos-status").html()),this.results=a},serializeData:function(){return this.results.responseJSON}})},Handlebars);
//# sourceMappingURL=maps/app.map